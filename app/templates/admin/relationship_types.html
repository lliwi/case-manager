{% extends "base.html" %}

{% block title %}Tipos de Relación - Administración{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h4 mb-0">Gestión de Tipos de Relación</h1>
        <small class="text-muted">
            {{ total_base_types }} tipos base | {{ total_custom_types }} tipos personalizados
        </small>
    </div>
    <div>
        <a href="{{ url_for('admin.index') }}" class="btn btn-outline-secondary me-2">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
        <a href="{{ url_for('admin.create_relationship_type') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Nuevo Tipo
        </a>
    </div>
</div>

<!-- Info Alert -->
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    <strong>Tipos de Relación:</strong> Los tipos base son parte del sistema y no se pueden modificar.
    Puedes crear tipos personalizados para relaciones específicas de tus investigaciones.
</div>

<!-- Relationship Types Table -->
<div class="card shadow">
    <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-diagram-2"></i> Tipos de Relación</h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 5%;">Tipo</th>
                        <th style="width: 20%;">Nombre</th>
                        <th style="width: 20%;">Etiqueta</th>
                        <th style="width: 35%;">Descripción</th>
                        <th style="width: 10%;">Estado</th>
                        <th style="width: 10%;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for type_stat in type_stats %}
                    <tr class="{% if not type_stat.is_active %}table-secondary{% endif %}">
                        <td>
                            {% if type_stat.is_custom %}
                                <span class="badge bg-primary">Custom</span>
                            {% else %}
                                <span class="badge bg-secondary">Base</span>
                            {% endif %}
                        </td>
                        <td>
                            <code>{{ type_stat.name }}</code>
                        </td>
                        <td>
                            <strong>{{ type_stat.label }}</strong>
                        </td>
                        <td>
                            <small class="text-muted">{{ type_stat.description[:100] }}{% if type_stat.description|length > 100 %}...{% endif %}</small>
                        </td>
                        <td>
                            {% if type_stat.is_active %}
                                <span class="badge bg-success">Activo</span>
                            {% else %}
                                <span class="badge bg-secondary">Inactivo</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if type_stat.is_custom %}
                                <div class="btn-group btn-group-sm" role="group">
                                    <!-- Edit -->
                                    <a href="{{ url_for('admin.edit_relationship_type', type_id=type_stat.custom_id) }}"
                                       class="btn btn-outline-primary"
                                       title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </a>

                                    <!-- Toggle Active Status -->
                                    <form method="POST" action="{{ url_for('admin.toggle_relationship_type', type_id=type_stat.custom_id) }}" class="d-inline">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                        <button type="submit"
                                                class="btn btn-outline-{% if type_stat.is_active %}warning{% else %}success{% endif %}"
                                                title="{% if type_stat.is_active %}Desactivar{% else %}Activar{% endif %}"
                                                onclick="return confirm('¿Confirmar cambio de estado?')">
                                            <i class="bi bi-{% if type_stat.is_active %}pause-circle{% else %}play-circle{% endif %}"></i>
                                        </button>
                                    </form>

                                    {% if type_stat.is_deletable %}
                                        <!-- Delete -->
                                        <form method="POST" action="{{ url_for('admin.delete_relationship_type', type_id=type_stat.custom_id) }}" class="d-inline">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                            <button type="submit"
                                                    class="btn btn-outline-danger"
                                                    title="Eliminar"
                                                    onclick="return confirm('¿Está seguro de eliminar este tipo de relación?')">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            {% else %}
                                <span class="text-muted">
                                    <small><i class="bi bi-lock"></i> Sistema</small>
                                </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            No hay tipos de relación disponibles.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Usage Guide -->
<div class="card shadow mt-4">
    <div class="card-header bg-light">
        <h6 class="mb-0"><i class="bi bi-book"></i> Guía de Uso</h6>
    </div>
    <div class="card-body">
        <h6>Tipos de Relación Base del Sistema:</h6>
        <ul class="small">
            <li><code>FAMILIAR_DE</code>: Relación familiar entre personas</li>
            <li><code>SOCIO_DE</code>: Relación comercial/societaria</li>
            <li><code>EMPLEADO_DE</code>: Relación laboral</li>
            <li><code>UTILIZA_TELEFONO</code>: Persona utiliza un teléfono</li>
            <li><code>UTILIZA_EMAIL</code>: Persona utiliza un email</li>
            <li><code>UTILIZA_VEHICULO</code>: Persona utiliza un vehículo</li>
            <li><code>PROPIETARIO_DE</code>: Propiedad de bienes</li>
            <li><code>RESIDE_EN</code>: Residencia en una dirección</li>
            <li><code>VISTO_EN</code>: Avistamiento en una ubicación</li>
            <li><code>CONTACTO_CON</code>: Contacto general entre entidades</li>
            <li><code>VINCULADO_A_EVIDENCIA</code>: Vinculación con evidencia</li>
            <li><code>PERFIL_DE</code>: Perfil social pertenece a persona</li>
            <li><code>TITULAR_DE</code>: Titularidad de cuenta bancaria</li>
            <li><code>TRANSFERENCIA_A</code>: Transferencia bancaria</li>
            <li><code>CONEXION_DESDE</code>: Conexión desde dirección IP</li>
        </ul>

        <h6 class="mt-3">Crear Tipos Personalizados:</h6>
        <p class="small mb-0">
            Puedes crear tipos personalizados para relaciones específicas de tus investigaciones.
            Los tipos personalizados se almacenan en PostgreSQL y se integran automáticamente con Neo4j
            al crear nuevas relaciones en el grafo.
        </p>
    </div>
</div>
{% endblock %}
